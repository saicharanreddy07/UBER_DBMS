CREATE TABLE USERS(
USER_ID VARCHAR(10) ,
FIRST_NAME VARCHAR(20),
LAST_NAME VARCHAR(20),
EMAIL_ID VARCHAR(30),
PRIMARY KEY(USER_ID));

INSERT INTO USERS VALUES ('U00','SAI','CHARAN','charan@gmail.com');
INSERT INTO USERS VALUES ('U01','SIDHARTH','NATH','sid@gmail.com');
INSERT INTO USERS VALUES ('U02','AD','SACHIN','sachin@gmail.com');
INSERT INTO USERS VALUES ('U03','ANURAG','NAYAK','anurag@gmail.com');
INSERT INTO USERS VALUES ('U04','SHASHI','KUMAR','shashi@gmail.com');
INSERT INTO USERS VALUES ('U05','YESHWANTH','KUMAR','yeshu@gmail.com');
INSERT INTO USERS VALUES ('U06','MANOJ','HARSHA','manoj@gmail.com');
INSERT INTO USERS VALUES ('U07','SUPRAJ','PULLURU','supraj@gmail.com');
INSERT INTO USERS VALUES ('U08','RAHUL','VEMULA','rahul@gmail.com');
INSERT INTO USERS VALUES ('U09','PRANAY','SUHAS','pranay@gmail.com');
INSERT INTO USERS VALUES ('U10','VISHNU','VARDHAN','vishnu@gmail.com');
INSERT INTO USERS VALUES ('U11','ROHIT','SHARMA','rohit@gmail.com');
INSERT INTO USERS VALUES ('U12','AKASH','VARMA','akash@gmail.com');
INSERT INTO USERS VALUES ('U13','DEEPTHI','SHETTY','deepthi@gmail.com');
INSERT INTO USERS VALUES ('U14','POONITHA','REDDY','poonitha@gmail.com');
INSERT INTO USERS VALUES ('U15','SAI','VARSHA','varsha@gmail.com');
INSERT INTO USERS VALUES ('U16','SHIVANI','REDDY','shivani@gmail.com');

SELECT *
FROM USERS;

CREATE TABLE USERS_PHN_NUMBER(USER_ID VARCHAR(10),
MOBILE_NUMBER INTEGER,PRIMARY KEY(USER_ID,MOBILE_NUMBER),
FOREIGN KEY (USER_ID) REFERENCES USERS);

DELETE USERS_PHN_NUMBER;
INSERT INTO USERS_PHN_NUMBER VALUES('U00',9392170417);
INSERT INTO USERS_PHN_NUMBER VALUES ('U00',8074794434);
INSERT INTO USERS_PHN_NUMBER VALUES('U01',7492482625);
INSERT INTO USERS_PHN_NUMBER VALUES ('U01',9854613794); 
INSERT INTO USERS_PHN_NUMBER VALUES ('U02',7654321098);
INSERT INTO USERS_PHN_NUMBER VALUES('U02',9876543210);
INSERT INTO USERS_PHN_NUMBER VALUES('U03',9765432109);
INSERT INTO USERS_PHN_NUMBER VALUES('U03',7456789012); 
INSERT INTO USERS_PHN_NUMBER VALUES('U04',7432109876);
INSERT INTO USERS_PHN_NUMBER VALUES('U04',9543210987); 
INSERT INTO USERS_PHN_NUMBER VALUES('U05',7543210987);
INSERT INTO USERS_PHN_NUMBER VALUES('U05',9890123456); 
INSERT INTO USERS_PHN_NUMBER VALUES('U06',9321098765);
INSERT INTO USERS_PHN_NUMBER VALUES('U06',8901234567); 
INSERT INTO USERS_PHN_NUMBER VALUES('U07',9210987654);
INSERT INTO USERS_PHN_NUMBER VALUES('U07',9012345678);
INSERT INTO USERS_PHN_NUMBER VALUES('U08',8109876543);
INSERT INTO USERS_PHN_NUMBER VALUES('U08',7023456789);
INSERT INTO USERS_PHN_NUMBER VALUES('U09',9876543210);
INSERT INTO USERS_PHN_NUMBER VALUES('U09',9876543211);
INSERT INTO USERS_PHN_NUMBER VALUES('U10',8765432109);
INSERT INTO USERS_PHN_NUMBER VALUES('U10',8765432114);
INSERT INTO USERS_PHN_NUMBER VALUES('U11',7654321098);
INSERT INTO USERS_PHN_NUMBER VALUES('U11',7654327458);
INSERT INTO USERS_PHN_NUMBER VALUES('U12',6543210987);
INSERT INTO USERS_PHN_NUMBER VALUES('U12',9543214715);
INSERT INTO USERS_PHN_NUMBER VALUES('U13',8452109876);
INSERT INTO USERS_PHN_NUMBER VALUES('U13',9432109876);
INSERT INTO USERS_PHN_NUMBER VALUES('U14',9321098765);
INSERT INTO USERS_PHN_NUMBER VALUES('U14',9875098765);
INSERT INTO USERS_PHN_NUMBER VALUES('U15',8654987654);
INSERT INTO USERS_PHN_NUMBER VALUES('U15',9874127654);
INSERT INTO USERS_PHN_NUMBER VALUES('U16',9109876543);
INSERT INTO USERS_PHN_NUMBER VALUES('U16',9452876543);

SELECT *
FROM USERS_PHN_NUMBER; 


CREATE TABLE REQUESTS(
    REQUEST_ID VARCHAR(10),
    PICKUP_LOC VARCHAR(20),
    DROPOFF_LOC VARCHAR(20),
    DISTANCE_IN_KM FLOAT,
    TYPE VARCHAR(10),
    USER_ID VARCHAR(10),
    FARE FLOAT,
    PRIMARY KEY(REQUEST_ID),
    FOREIGN KEY (USER_ID) REFERENCES USERS);
    
INSERT INTO REQUESTS VALUES('R01','UPPAL','LB NAGAR',10.2,'CAR','U01',0);
INSERT INTO REQUESTS VALUES('R02','HITECH CITY','ARAMGHAR',19.5,'CAR','U00',0);
INSERT INTO REQUESTS VALUES('R03','UPPAL','GACHIBOWLI',26.9,'CAR','U07',0);
INSERT INTO REQUESTS VALUES('R04','ALIPIRI','ANAMAYA CIRCLE',7.2,'CAR','U05',0);
INSERT INTO REQUESTS VALUES('R05','SECUNDERABAD','LB NAGAR',17.1,'BIKE','U10',0);
INSERT INTO REQUESTS VALUES('R06','MEHIDHIPATNAMAM','NARSINGI',10.9,'AUTO','U12',0);
INSERT INTO REQUESTS VALUES('R07','UPPAL','MEHIDHIPATNAM',20.3,'CAR','U03',0);
INSERT INTO REQUESTS VALUES('R08','AMEERPET','GACHI BOWLI',14.1,'AUTO','U16',0);
INSERT INTO REQUESTS VALUES('R09','KUKATPALLY','NECKLACE ROAD',16.4,'BIKE','U01',0);
INSERT INTO REQUESTS VALUES('R10','MADHAPUR','ABIDS',14.1,'BIKE','U11',0);
INSERT INTO REQUESTS VALUES('R11','KOTI','MEHIDHIPATNAM',7.5,'AUTO','U07',0);
INSERT INTO REQUESTS VALUES('R12','NAMPALLY','LAKDIKAPUL',2,'CAR','U04',0);
INSERT INTO REQUESTS VALUES('R13','HIMAYATHNAGAR','MIYAPUR',24,'AUTO','U08',0);
INSERT INTO REQUESTS VALUES('R14','KAIRATHABAD','GOLKONDA',10.2,'CAR','U06',0);
INSERT INTO REQUESTS VALUES('R15','PANJAGUTTA','ATTAPUR',8.9,'CAR','U09',0);
INSERT INTO REQUESTS VALUES('R16','UPPAL','CHARMINAR',12.7,'BIKE','U00',0);
INSERT INTO REQUESTS VALUES('R17','OSMAN NAGAR','CHARMINAR',43.1,'AUTO','U02',0);
INSERT INTO REQUESTS VALUES('R18','VANASTHALIPURAM','LB NAGAR',3.1,'CAR','U05',0);
INSERT INTO REQUESTS VALUES('R19','JUBILEE HILLS','LB NAGAR',24,'BIKE','U09',0);
INSERT INTO REQUESTS VALUES('R20','BANJARA HILLS','JUBILEE HILLS',5.6,'CAR','U12',0);
INSERT INTO REQUESTS VALUES('R21','UPPAL','PANJA GUTTA',16.6,'AUTO','U14',0);
INSERT INTO REQUESTS VALUES('R22','LB NAGAR','UPPAL',10.2,'CAR','U06',0);
INSERT INTO REQUESTS VALUES('R23','MIYAPUR','HIMAYATHNAGAR',24,'CAR','U10',0);
INSERT INTO REQUESTS VALUES('R24','LB NAGAR','SHAMSHABAD',22.1,'AUTO','U16',0);
INSERT INTO REQUESTS VALUES('R25','AMBERPET','RAMOJI FILM CITY',23,'CAR','U07',0);

SELECT * FROM REQUESTS;

UPDATE REQUESTS
SET FARE=DISTANCE_IN_KM*15
WHERE TYPE='CAR';

UPDATE REQUESTS
SET FARE=DISTANCE_IN_KM*10
WHERE TYPE='AUTO';

UPDATE REQUESTS
SET FARE=DISTANCE_IN_KM*7
WHERE TYPE='BIKE';

UPDATE REQUESTS
SET FARE=CEIL(FARE);

SELECT * FROM REQUESTS;

CREATE TABLE VEHICLE_TYPE(
TYPE VARCHAR(10),
RATE_PER_KILOMETER NUMERIC,
CAPACITY INTEGER,
PRIMARY KEY(TYPE));

INSERT INTO VEHICLE_TYPE VALUES('CAR',15,3);
INSERT INTO VEHICLE_TYPE VALUES('AUTO',10,2);
INSERT INTO VEHICLE_TYPE VALUES('BIKE',7,1);

SELECT *
FROM VEHICLE_TYPE;

CREATE TABLE DRIVER(
DRIVER_ID VARCHAR(10),
FIRST_NAME VARCHAR(10),
LAST_NAME VARCHAR(10),
GENDER VARCHAR(1),
AVAILABLE_STATUS INTEGER,
LICENCE_NUMBER VARCHAR(20),
MOBILE_NUMBER INTEGER,
RATING FLOAT,
VEHICLE_NUMBER VARCHAR(20),
PRIMARY KEY (DRIVER_ID)
);
DROP TABLE DRIVER;

INSERT INTO DRIVER VALUES('D01','RAMESH','KUMAR','M',1,'TS03820220004450',7845912345,0,'TS 06 EB 4835');
INSERT INTO DRIVER VALUES('D02','AMIT','Sharma','M',1,'TS01234567891200',9876543210,0,'TS 07 ES 7485');
INSERT INTO DRIVER VALUES('D03','NEHA','SINGH','F',1,'TS98765432109800',8765432109,0,'TS 08 AK 1947');
INSERT INTO DRIVER VALUES('D04','RAJESH','GOUD','M',0,'TS87654321098700',7654321098,0,'AP 07 KS 4875');
INSERT INTO DRIVER VALUES('D05','PRIYANKA','KULKARNI','F',1,'TS76543210987600',9543210987,0,'AP 05 ED 7548');
INSERT INTO DRIVER VALUES('D06','VIKRAM','SINGH','M',0,'TS65432109876500',9432109876,0,'TS 09 AS 1234');
INSERT INTO DRIVER VALUES('D07','ARUN','KUMAR','M',1,'TS54321098765400',9321098765,0,'AP 09 QW 9874');

SELECT * FROM DRIVER;

CREATE  TABLE VEHICLE(
VEHICLE_ID VARCHAR(20),
TYPE VARCHAR(10),
PRIMARY KEY(VEHICLE_ID),
FOREIGN KEY (TYPE) REFERENCES VEHICLE_TYPE);


INSERT INTO VEHICLE VALUES('TS 06 EB 4835','CAR');
INSERT INTO VEHICLE VALUES('TS 07 ES 7485','CAR');
INSERT INTO VEHICLE VALUES('TS 08 AK 1947','AUTO');
INSERT INTO VEHICLE VALUES('AP 07 KS 4875','AUTO');
INSERT INTO VEHICLE VALUES('AP 05 ED 7548','BIKE');
INSERT INTO VEHICLE VALUES('TS 09 AS 1234','BIKE');
INSERT INTO VEHICLE VALUES('AP 09 QW 9874','CAR');

SELECT * FROM VEHICLE;

CREATE TABLE TRIP(
REQUEST_ID VARCHAR(10),
DRIVER_ID VARCHAR(10),
PAYMENT_ID VARCHAR(10),
DATE_OD_BOOKING DATE,
FARE FLOAT,
PRIMARY KEY(REQUEST_ID),
FOREIGN KEY(REQUEST_ID) REFERENCES REQUESTS,
FOREIGN KEY(DRIVER_ID) REFERENCES DRIVER);

DROP TABLE TRIP;
INSERT INTO TRIP VALUES('R01','D01','P01','02 JAN 2022',153);
INSERT INTO TRIP VALUES('R02','D02','P02','03 JAN 2022',293);
INSERT INTO TRIP VALUES('R03','D07','P03','05 JAN 2022',404);
INSERT INTO TRIP VALUES('R04','D01','P04','06 JAN 2022',108);
INSERT INTO TRIP VALUES('R05','D05','P05','08 JAN 2022',120);
INSERT INTO TRIP VALUES('R06','D03','P06','08 JAN 2022',109);
INSERT INTO TRIP VALUES('R07','D02','P07','08 JAN 2022',305);
INSERT INTO TRIP VALUES('R08','D04','P08','12 JAN 2022',141);
INSERT INTO TRIP VALUES('R09','D06','P09','14 JAN 2022',115);
INSERT INTO TRIP VALUES('R10','D05','P10','14 JAN 2022',99);
INSERT INTO TRIP VALUES('R11','D03','P11','17 JAN 2022',75);
INSERT INTO TRIP VALUES('R12','D07','P12','18 JAN 2022',30);
INSERT INTO TRIP VALUES('R13','D04','P13','20 JAN 2022',240);
INSERT INTO TRIP VALUES('R14','D01','P14','20 JAN 2022',153);
INSERT INTO TRIP VALUES('R15','D07','P15','23 JAN 2022',134);


SELECT * FROM TRIP;

CREATE TABLE FEEDBACK(
REQUEST_ID VARCHAR(10),
USER_ID VARCHAR(10),
RATING FLOAT,
COMMENTS VARCHAR(200),
PRIMARY KEY(REQUEST_ID),
FOREIGN KEY(REQUEST_ID) REFERENCES TRIP,
FOREIGN KEY(USER_ID) REFERENCES USERS);

DROP TABLE FEEDBACK;

INSERT INTO FEEDBACK VALUES('R01','U01',4.5,'GOOD');
INSERT INTO FEEDBACK VALUES('R02','U00',4,'GOOD');
INSERT INTO FEEDBACK VALUES('R03','U07',2,'BAD');
INSERT INTO FEEDBACK VALUES('R04','U05',4.9,'GOOD');
INSERT INTO FEEDBACK VALUES('R05','U10',4.5,'GOOD');
INSERT INTO FEEDBACK VALUES('R06','U12',3.5,'AVERAGE');
INSERT INTO FEEDBACK VALUES('R07','U03',2.5,'TIME DELAY');
INSERT INTO FEEDBACK VALUES('R08','U16',3.8,'BETTER');
INSERT INTO FEEDBACK VALUES('R09','U01',4.4,'GOOD DRIVING');
INSERT INTO FEEDBACK VALUES('R10','U11',4.7,'GOOD');

SELECT * FROM FEEDBACK;

SELECT AVG(RATING)
FROM (SELECT * FROM FEEDBACK
NATURAL JOIN TRIP)
GROUP BY DRIVER_ID;


UPDATE DRIVER
SET RATING=(SELECT AVG(RATING)
FROM (SELECT * FROM FEEDBACK
NATURAL JOIN TRIP)
GROUP BY DRIVER_ID
HAVING DRIVER_ID='D07')
WHERE DRIVER_ID='D07';

SELECT * FROM DRIVER;

CREATE TABLE PAYMENT(
PAYMENT_ID VARCHAR(20),
CASH INT,
REQUEST_ID VARCHAR(10),
TIME_OF_PAYMENT DATE,
PRIMARY KEY(PAYMENT_ID),
FOREIGN KEY(REQUEST_ID) REFERENCES TRIP);

DROP TABLE PAYMENT;
INSERT INTO PAYMENT VALUES('P01', 0, 'R01','02-JAN-2022');
INSERT INTO PAYMENT VALUES('P02', 1, 'R02','03-JAN-2022');
INSERT INTO PAYMENT VALUES('P03', 0, 'R03','05-JAN-2022');
INSERT INTO PAYMENT VALUES('P04', 1, 'R04','06-JAN-2022');
INSERT INTO PAYMENT VALUES('P05', 0, 'R05','08-JAN-2022');
INSERT INTO PAYMENT VALUES('P06', 1, 'R06','08-JAN-2022');
INSERT INTO PAYMENT VALUES('P07', 0, 'R07','08-JAN-2022');
INSERT INTO PAYMENT VALUES('P08', 1, 'R08','12-JAN-2022');
INSERT INTO PAYMENT VALUES('P09', 0, 'R09','14-JAN-2022');
INSERT INTO PAYMENT VALUES('P10', 1, 'R10','14-JAN-2022');
INSERT INTO PAYMENT VALUES('P11', 1, 'R11','17-JAN-2022');
INSERT INTO PAYMENT VALUES('P12', 1, 'R12','18-JAN-2022');
INSERT INTO PAYMENT VALUES('P13', 0, 'R13','20-JAN-2022');
INSERT INTO PAYMENT VALUES('P14', 1, 'R14','20-JAN-2022');
INSERT INTO PAYMENT VALUES('P15', 0, 'R15','23-JAN-2022');

SELECT *
FROM PAYMENT;

CREATE TABLE CARD_PAYMENT(
CARD_NUM VARCHAR(10),
FIRSTNAME VARCHAR(20),
LASTNAME VARCHAR(20),
CARD_TYPE VARCHAR(20),
EXPIRY_DATE DATE,
PAYMENT_ID VARCHAR(20),
PRIMARY KEY(CARD_NUM),
FOREIGN KEY(PAYMENT_ID) REFERENCES PAYMENT);

DROP TABLE CARD_PAYMENT;
INSERT INTO CARD_PAYMENT VALUES('C101','SIDHARTH','NATH','VISA','15-07-2025','P01');
INSERT INTO CARD_PAYMENT VALUES('C113','RAHUL','VEMULA','AMERICANEXPRESS','22-08-2026','P13');
INSERT INTO CARD_PAYMENT VALUES('C115','PRANAY','SUHAS','MASTERCARD','09-06-2026','P15');

SELECT *
FROM CARD_PAYMENT;

CREATE TABLE GIFT_CARD(
CARD_NO VARCHAR(10),
AMOUNT_IN_CARD NUMERIC,
GEXPIRY_DATE DATE,
PAYMENT_ID VARCHAR(20),
PRIMARY KEY(CARD_NO),
FOREIGN KEY(PAYMENT_ID) REFERENCES PAYMENT);

DROP TABLE GIFT_CARD;
INSERT INTO GIFT_CARD VALUES('G101',980,'12-06-2023','P09');
SELECT *
FROM GIFT_CARD;

CREATE TABLE UPI_APPS(
TRANSACTION_ID VARCHAR(20),
UPI_ID VARCHAR(10),
PAYMENT_ID VARCHAR(20),
PRIMARY KEY(TRANSACTION_ID),
FOREIGN KEY(PAYMENT_ID) REFERENCES PAYMENT);

DROP TABLE UPI_APPS;
DELETE UPI_APPS;
SELECT *
FROM UPI_APPS;

INSERT INTO UPI_APPS VALUES('TNT01','SUP@SBI','P03');
INSERT INTO UPI_APPS VALUES('TNT05','VISHNU@KOT','P05');
INSERT INTO UPI_APPS VALUES('TNT07','ANURAG@SBI','P07');
INSERT INTO UPI_APPS VALUES('TNT09','CHARAN@SBI','P02');



--LIST OUT THE USERS WHO HAVE DONE CASH PAYMENT
SELECT USER_ID
FROM REQUESTS NATURAL JOIN (SELECT *
                             FROM PAYMENT NATURAL JOIN TRIP
                              WHERE CASH=1);
--LIST OUT THE DRIVERS HAVING RATING MORE THAN 4
SELECT DRIVER_ID,FIRST_NAME,LAST_NAME
FROM DRIVER
WHERE RATING>4;
--AT THE MOMENT WHO ARE THE DRIVERS AVAILABLE FOR BOOKING
SELECT DRIVER_ID,FIRST_NAME,LAST_NAME
FROM DRIVER
WHERE AVAILABLE_STATUS=1;
--USERS WHO REQUESTED MOST OF THE TIMES
SELECT USER_ID,X AS NUMBER_OF_REQUESTS
FROM (SELECT COUNT(USER_ID) AS X,USER_ID
       FROM REQUESTS
        GROUP BY USER_ID)
WHERE X=(SELECT MAX(COUNT(USER_ID)) 
       FROM REQUESTS
        GROUP BY USER_ID);

--NUMBER OF TRIPS DONE ON 8JAN 2022
SELECT COUNT(REQUEST_ID)
FROM TRIP
WHERE DATE_OD_BOOKING='08 JAN 2022';
--WHAT IS RATE PER KM FOR EACH TYPE OF VEHICLE
SELECT TYPE,RATE_PER_KILOMETER FROM VEHICLE_TYPE;
--LIST OUT FEMALE DRIVERS
SELECT DRIVER_ID,FIRST_NAME,LAST_NAME
FROM DRIVER
WHERE GENDER='F'